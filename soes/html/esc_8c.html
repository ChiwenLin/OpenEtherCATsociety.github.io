<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SOES: esc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SOES&#160;<span id="projectnumber">v1.0.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">esc.c File Reference</div>  </div>
</div>
<div class="contents">

<p>Base EtherCAT functions for handling the Data Link Layer and Malilboxes.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;utypes.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="esc_8h.html">esc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="esc__coe_8h.html">esc_coe.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="esc__foe_8h.html">esc_foe.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#ae49fff6e6440edd2c55a077d724b898c">ESC_ALerror</a> (uint16 errornumber)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a9794dd94da984eb6bfb88879aabf4e3d">ESC_ALstatus</a> (uint8 status)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#ad4f4c1dd0c961f827f8f1d578fed087d">ESC_SMack</a> (uint8 n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#ad419b1ac3abaf24fa53d55ede4810ce7">ESC_SMstatus</a> (uint8 n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a602dae15b9286e4ab4716fb85f8f3c58">ESC_SMwritepdi</a> (uint8 n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a20ec7aa0e6d89492dc4562b9c4657f6f">ESC_SMenable</a> (uint8 n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#af318524ace0e280d9e87afc9f73b57fa">ESC_SMdisable</a> (uint8 n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a152dee1d6c0bce00aa029d833e147380">ESC_address</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a86d7576d9f8b1e63ad8ad2a6cf991c50">ESC_WDstatus</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#aeee5a004e7e70410ceb89c26537a2ccf">ESC_checkmbx</a> (uint8 state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#afc72202bfde332668a10d54e3b56083b">ESC_startmbx</a> (uint8 state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a5cd0a7feb7e50e42fcdb71e6a28799ab">ESC_checkmbxboot</a> (uint8 state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a99dd26de7272793bd6ffe56af9316fbe">ESC_startmbxboot</a> (uint8 state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#af114806603011938e35ae366d115d90f">ESC_stopmbx</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a268c2208d13c00552cc25c7c823c78b3">ESC_readmbx</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#add404335229e458ca751345aa701f3ce">ESC_writembx</a> (uint8 n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a3833c0b62cdc0b62ee929154e9744fcc">ESC_ackmbxread</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a9cdac6a8b19f5a033267973c6b97e501">ESC_claimbuffer</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#ab5fb5800733c7419cad42f030860b966">ESC_outreqbuffer</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#ad4d3079177cc7d1bd78862b5a5cb7fe7">MBX_error</a> (uint16 error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#ae75d37a1bdce82374c3b262f18945cb3">ESC_mbxprocess</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#aa783bb45ace470b98607ce7c4af0460f">ESC_xoeprocess</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a24ef310d3626f86db81293553d0a6c88">ESC_checkSM23</a> (uint8 state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a7e667a53ef89c4a27578e26e2479d05d">ESC_startinput</a> (uint8 state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a81ea48b9683662e8bed01fbb77826236">ESC_stopinput</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a5e77a7172bd88586c08829b6d5977016">ESC_startoutput</a> (uint8 state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#aea60761cf8862550e8901aa996069f8d">ESC_stopoutput</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a1f4da4aa96dc469b218abf33ff857130">ESC_state</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a5ddaf0c8fd9944f21be30480125b6736">ESC_config</a> (<a class="el" href="structesc__cfg__t.html">esc_cfg_t</a> *cfg)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structesc__cfg__t.html">esc_cfg_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="esc_8c.html#a23be27590c28284bdca777f918b40d09">esc_cfg</a> = NULL</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Base EtherCAT functions for handling the Data Link Layer and Malilboxes. </p>
<p>State machine and mailbox support. </p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a3833c0b62cdc0b62ee929154e9744fcc"></a><!-- doxytag: member="esc.c::ESC_ackmbxread" ref="a3833c0b62cdc0b62ee929154e9744fcc" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_ackmbxread </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>TBD </p>

</div>
</div>
<a class="anchor" id="a152dee1d6c0bce00aa029d833e147380"></a><!-- doxytag: member="esc.c::ESC_address" ref="a152dee1d6c0bce00aa029d833e147380" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_address </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read Configured Station Address register 0x010 assigned by the Master. </p>

</div>
</div>
<a class="anchor" id="ae49fff6e6440edd2c55a077d724b898c"></a><!-- doxytag: member="esc.c::ESC_ALerror" ref="ae49fff6e6440edd2c55a077d724b898c" args="(uint16 errornumber)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_ALerror </td>
          <td>(</td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>errornumber</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Write AL Status Code to the ESC.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">errornumber</td><td>= Write an by EtherCAT specified Error number register 0x134 AL Status Code </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a9794dd94da984eb6bfb88879aabf4e3d"></a><!-- doxytag: member="esc.c::ESC_ALstatus" ref="a9794dd94da984eb6bfb88879aabf4e3d" args="(uint8 status)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_ALstatus </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>status</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Write AL Status to the ESC.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">status</td><td>= Write current slave status to register 0x130 AL Status reflecting actual state and error indication if present </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aeee5a004e7e70410ceb89c26537a2ccf"></a><!-- doxytag: member="esc.c::ESC_checkmbx" ref="aeee5a004e7e70410ceb89c26537a2ccf" args="(uint8 state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ESC_checkmbx </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check mailbox status by reading all SyncManager 0 and 1 data. The read values are compared with local definitions for SM Physical Address, SM Length and SM Control. If we check fails we disable Mailboxes by disabling SyncManager 0 and 1 and return state Init with Error flag set.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>= Current state request read from ALControl 0x0120 </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>if all Mailbox values is correct we return incoming state request, otherwise we return state Init with Error flag set. </dd></dl>

</div>
</div>
<a class="anchor" id="a5cd0a7feb7e50e42fcdb71e6a28799ab"></a><!-- doxytag: member="esc.c::ESC_checkmbxboot" ref="a5cd0a7feb7e50e42fcdb71e6a28799ab" args="(uint8 state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ESC_checkmbxboot </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check boostrap mailbox status by reading all SyncManager 0 and 1 data. The read values are compared with local definitions for SM Physical Address, SM Length and SM Control. If we check fails we disable Mailboxes by disabling SyncManager 0 and 1 and return state Init with Error flag set.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>= Current state request read from ALControl 0x0120 </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>if all Mailbox values is correct we return incoming state request, otherwise we return state Init with Error flag set. </dd></dl>

</div>
</div>
<a class="anchor" id="a24ef310d3626f86db81293553d0a6c88"></a><!-- doxytag: member="esc.c::ESC_checkSM23" ref="a24ef310d3626f86db81293553d0a6c88" args="(uint8 state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ESC_checkSM23 </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Validate the values of Sync Manager 2 &amp; 3 that the current ESC values is equal to configured and calculated local values.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>= Requested state. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>= incoming state request if every thing checks out OK. = state (PREOP | ERROR) if something isn't correct. </dd></dl>

</div>
</div>
<a class="anchor" id="a9cdac6a8b19f5a033267973c6b97e501"></a><!-- doxytag: member="esc.c::ESC_claimbuffer" ref="a9cdac6a8b19f5a033267973c6b97e501" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ESC_claimbuffer </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Allocate and prepare a mailbox buffer. Take the first Idle buffer from the End. Set Mailbox control state to be used for outbox and fill the mailbox buffer with address master and mailbox next CNT value between 1-7.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The index of Mailbox buffer prepared for outbox. IF no buffer is available return 0. </dd></dl>

</div>
</div>
<a class="anchor" id="a5ddaf0c8fd9944f21be30480125b6736"></a><!-- doxytag: member="esc.c::ESC_config" ref="a5ddaf0c8fd9944f21be30480125b6736" args="(esc_cfg_t *cfg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_config </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structesc__cfg__t.html">esc_cfg_t</a> *&#160;</td>
          <td class="paramname"><em>cfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function copying the application configuration variable to the stack local pointer variable.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg</td><td>= Pointer to by the Application static declared configuration variable holding application specific details. Ex. post- and pre state change hooks </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae75d37a1bdce82374c3b262f18945cb3"></a><!-- doxytag: member="esc.c::ESC_mbxprocess" ref="ae75d37a1bdce82374c3b262f18945cb3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ESC_mbxprocess </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Mailbox routine for implementing the low-level part of the mailbox protocol used by Application Layers running on-top of mailboxes. It takes care of sending a mailbox, re-sending a mailbox, reading a mailbox and handles a mailbox full event.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>=0 if nothing to do. =1 if something to be handled by mailbox protocols. </dd></dl>

</div>
</div>
<a class="anchor" id="ab5fb5800733c7419cad42f030860b966"></a><!-- doxytag: member="esc.c::ESC_outreqbuffer" ref="ab5fb5800733c7419cad42f030860b966" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ESC_outreqbuffer </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Look for any present requests for posting to the outbox.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>the index of Mailbox buffer ready to be posted. </dd></dl>

</div>
</div>
<a class="anchor" id="a268c2208d13c00552cc25c7c823c78b3"></a><!-- doxytag: member="esc.c::ESC_readmbx" ref="a268c2208d13c00552cc25c7c823c78b3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_readmbx </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read Receive mailbox and store data in local ESCvar.MBX variable. Combined function for bootstrap and other states. State check decides which one to read. </p>

</div>
</div>
<a class="anchor" id="ad4f4c1dd0c961f827f8f1d578fed087d"></a><!-- doxytag: member="esc.c::ESC_SMack" ref="ad4f4c1dd0c961f827f8f1d578fed087d" args="(uint8 n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_SMack </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read SM Status register 0x805(+ offset to SyncManager n) to acknowledge a Sync Manager event Bit 3 in ALevent. The result is not used.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>= Read Sync Manager no. n </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="af318524ace0e280d9e87afc9f73b57fa"></a><!-- doxytag: member="esc.c::ESC_SMdisable" ref="af318524ace0e280d9e87afc9f73b57fa" args="(uint8 n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_SMdisable </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Write 1 to Bit0 in SM PDI control register 0x807(+ offset to SyncManager n) to De-activte the Sync Manager n.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>= Write to Sync Manager no. n </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a20ec7aa0e6d89492dc4562b9c4657f6f"></a><!-- doxytag: member="esc.c::ESC_SMenable" ref="a20ec7aa0e6d89492dc4562b9c4657f6f" args="(uint8 n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_SMenable </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Write 0 to Bit0 in SM PDI control register 0x807(+ offset to SyncManager n) to Activate the Sync Manager n.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>= Write to Sync Manager no. n </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad419b1ac3abaf24fa53d55ede4810ce7"></a><!-- doxytag: member="esc.c::ESC_SMstatus" ref="ad419b1ac3abaf24fa53d55ede4810ce7" args="(uint8 n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_SMstatus </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read SM Status register 0x805(+ offset to SyncManager n) and save the result in global variable ESCvar.SM[n].</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>= Read Sync Manager no. n </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a602dae15b9286e4ab4716fb85f8f3c58"></a><!-- doxytag: member="esc.c::ESC_SMwritepdi" ref="a602dae15b9286e4ab4716fb85f8f3c58" args="(uint8 n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_SMwritepdi </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Write ESCvar.SM[n] data to ESC PDI control register 0x807(+ offset to SyncManager n).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>= Write to Sync Manager no. n </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a7e667a53ef89c4a27578e26e2479d05d"></a><!-- doxytag: member="esc.c::ESC_startinput" ref="a7e667a53ef89c4a27578e26e2479d05d" args="(uint8 state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ESC_startinput </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function trying to enable start updating the process data inputs. It calls the check SM 2 &amp; 3 routine, based on the result from there if enables or disables the Input SyncManager, in addition it updates the ALStatusCode case something didn't pass the check.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>= Requested state. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>= state, incoming state request if every thing checks out OK. =state (PREOP | ERROR) if something isn't correct. </dd></dl>

</div>
</div>
<a class="anchor" id="afc72202bfde332668a10d54e3b56083b"></a><!-- doxytag: member="esc.c::ESC_startmbx" ref="afc72202bfde332668a10d54e3b56083b" args="(uint8 state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ESC_startmbx </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Try to start mailboxes for current ALControl state request by enabling SyncManager 0 and 1. If all mailbox settings is correct we return incoming state request, otherwise we return state Init with Error flag set and update local ALerror with code 0x16 Invalid mailbox configuration.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>= Current state request read from ALControl 0x0120 </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>if all Mailbox values is correct we return incoming state, otherwise we return state Init with Error flag set. </dd></dl>

</div>
</div>
<a class="anchor" id="a99dd26de7272793bd6ffe56af9316fbe"></a><!-- doxytag: member="esc.c::ESC_startmbxboot" ref="a99dd26de7272793bd6ffe56af9316fbe" args="(uint8 state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ESC_startmbxboot </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Try to start bootstrap mailboxes for current ALControl state request by enabling SyncManager 0 and 1. If all mailbox settings is correct we return incoming state request, otherwise we return state Init with Error flag set and update local ALerror with code 0x16 Invalid mailbox configuration.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>= Current state request read from ALControl 0x0120 </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>if all Mailbox values is correct we return incoming state, otherwise we return state Init with Error flag set. </dd></dl>

</div>
</div>
<a class="anchor" id="a5e77a7172bd88586c08829b6d5977016"></a><!-- doxytag: member="esc.c::ESC_startoutput" ref="a5e77a7172bd88586c08829b6d5977016" args="(uint8 state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ESC_startoutput </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Unconditional start of updating outputs by enabling Sync Manager 2. Set the App.state to APPSTATE_OUTPUT.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>= Not used. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>= state unchanged. </dd></dl>

</div>
</div>
<a class="anchor" id="a1f4da4aa96dc469b218abf33ff857130"></a><!-- doxytag: member="esc.c::ESC_state" ref="a1f4da4aa96dc469b218abf33ff857130" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_state </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The state handler acting on ALControl Bit(0) and SyncManager Activation BIT(4) events in the Al Event Request register 0x220. </p>

</div>
</div>
<a class="anchor" id="a81ea48b9683662e8bed01fbb77826236"></a><!-- doxytag: member="esc.c::ESC_stopinput" ref="a81ea48b9683662e8bed01fbb77826236" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_stopinput </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Unconditional stop of updating inputs by disabling Sync Manager 2 &amp; 3. Set the App.state to APPSTATE_IDLE. </p>

</div>
</div>
<a class="anchor" id="af114806603011938e35ae366d115d90f"></a><!-- doxytag: member="esc.c::ESC_stopmbx" ref="af114806603011938e35ae366d115d90f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_stopmbx </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Stop mailboxes by disabling SyncManager 0 and 1. Clear local mailbox variables stored in ESCvar. </p>

</div>
</div>
<a class="anchor" id="aea60761cf8862550e8901aa996069f8d"></a><!-- doxytag: member="esc.c::ESC_stopoutput" ref="aea60761cf8862550e8901aa996069f8d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_stopoutput </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Unconditional stop of updating outputs by disabling Sync Manager 2. Set the App.state to APPSTATE_ONPUT. Call application hook APP_safeoutput letting the user to set safe state values on outputs. </p>

</div>
</div>
<a class="anchor" id="a86d7576d9f8b1e63ad8ad2a6cf991c50"></a><!-- doxytag: member="esc.c::ESC_WDstatus" ref="a86d7576d9f8b1e63ad8ad2a6cf991c50" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ESC_WDstatus </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read Watchdog Status register 0x440. Result Bit0 0= Expired, 1= Active or disabled.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>value of register Watchdog Status. </dd></dl>

</div>
</div>
<a class="anchor" id="add404335229e458ca751345aa701f3ce"></a><!-- doxytag: member="esc.c::ESC_writembx" ref="add404335229e458ca751345aa701f3ce" args="(uint8 n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_writembx </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Write local mailbox buffer ESCvar.MBX[n] to Send mailbox. Combined function for bootstrap and other states. State check decides which one to write.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>= Which local mailbox buffer n to send. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aa783bb45ace470b98607ce7c4af0460f"></a><!-- doxytag: member="esc.c::ESC_xoeprocess" ref="aa783bb45ace470b98607ce7c4af0460f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ESC_xoeprocess </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handler for incorrect or unsupported mailbox data. Write error response in Mailbox. </p>

</div>
</div>
<a class="anchor" id="ad4d3079177cc7d1bd78862b5a5cb7fe7"></a><!-- doxytag: member="esc.c::MBX_error" ref="ad4d3079177cc7d1bd78862b5a5cb7fe7" args="(uint16 error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MBX_error </td>
          <td>(</td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>error</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Allocate and prepare a mailbox buffer for sending an error message. Take the first Idle buffer from the end. Set Mailbox control state to be used for outbox and fill the mailbox buffer with error information.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>= Error number to be sent in mailbox error message. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a23be27590c28284bdca777f918b40d09"></a><!-- doxytag: member="esc.c::esc_cfg" ref="a23be27590c28284bdca777f918b40d09" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structesc__cfg__t.html">esc_cfg_t</a>* <a class="el" href="esc_8c.html#a23be27590c28284bdca777f918b40d09">esc_cfg</a> = NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Jul 10 2013 11:14:19 for SOES by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
